name: build
on: [pull_request, push]

jobs:
  build:
    runs-on: ubuntu-24.04
    steps:
      # 1. Checkout the Master Project (piggy-mods)
      # We enable 'submodules: true' here. 
      # This is the FIX: It ensures 'piggy-lib' is downloaded so other mods can compile against it.
      - name: Checkout Master Project
        uses: actions/checkout@v4
        with:
          repository: porkyoot/piggy-mods
          submodules: true 
          path: .

      # 2. Checkout the CURRENT submodule code
      # This overwrites the specific folder (e.g. piggy-admin) in the master project
      # with the fresh code from this commit.
      - name: Checkout Submodule (Current)
        uses: actions/checkout@v4
        with:
          # CHANGE THIS: Match the folder name in piggy-mods (e.g., piggy-admin, piggy-inventory)
          path: piggy-admin 

      - name: Validate Gradle Wrapper
        uses: gradle/actions/wrapper-validation@v4

      - name: Setup JDK
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'microsoft'

      - name: Make Gradle Wrapper Executable
        run: chmod +x ./gradlew

      # 3. Run the build for THIS specific project only
      # CHANGE THIS: Update the project name (e.g., :piggy-admin:build)
      - name: Build
        run: ./gradlew :piggy-admin:build

      # 4. Upload Artifacts
      # CHANGE THIS: Path to the specific module's build folder
      - name: Capture Build Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: Artifacts
          path: piggy-admin/build/libs/